<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer App</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            /* REPLACE THIS AREA - Mobile background (50-100KB, 480px wide) */
            background: url(Backgrounds/great-wave-off-kanagawa-katsushika-hokusai-1833-25047ac6.jpg) no-repeat center center;
            background-size: cover;
            color: white;
            zoom: calc(100vw / 1920 * 100%);
        }
        
        /* Responsive background images for different screen sizes */
        @media (min-width: 481px) and (max-width: 768px) {
            body {
                /* REPLACE THIS AREA - Tablet background (100-200KB, 768px wide) */
                background-image: url(Backgrounds/great-wave-off-kanagawa-katsushika-hokusai-1833-25047ac6.jpg);
            }
        }
        
        @media (min-width: 769px) and (max-width: 1920px) {
            body {
                /* REPLACE THIS AREA - Desktop background (200-400KB, 1920px wide) */
                background-image: url(Backgrounds/great-wave-off-kanagawa-katsushika-hokusai-1833-25047ac6.jpg);
            }
        }
        
        @media (min-width: 1921px) {
            body {
                /* REPLACE THIS AREA - Desktop background (loads 1920w, 4K loaded via JavaScript) */
                background-image: url(Backgrounds/great-wave-off-kanagawa-katsushika-hokusai-1833-25047ac6.jpg);
            }
        }
        
        /* High DPI displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            body {
                /* REPLACE THIS AREA - High DPI background (loads 1920w, 4K loaded via JavaScript) */
                background-image: url(Backgrounds/great-wave-off-kanagawa-katsushika-hokusai-1833-25047ac6.jpg);
            }
        }
        
        .timer-container {
            text-align: center;
            background: rgba(255, 255, 255, 0);
            padding: 18px 18px 18px 18px;
            border-radius: 14.4px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            min-width: 700px;
            width: 100%;
            max-width: 900px;
        }
        
        .timer-display {
            font-size: 7.56rem;
            font-weight: bold;
            margin: 18px 0;
            font-family: 'Courier New', monospace;
            text-shadow: 4.8px 4.8px 9.6px rgba(0, 0, 0, 0.9);
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .text-area-section {
            margin: 18px 0;
        }
        
        .rich-text-editor {
            width: 100%;
            min-height: 140px;
            height: 140px;
            max-height: 640px;
            padding: 4.8px;
            font-size: 2.5rem;
            font-family: 'Arial', sans-serif;
            border: none;
            border-radius: 7.2px;
            background: rgba(0, 0, 0, 0.6);
            color: #E8E8E8;
            backdrop-filter: blur(5px);
            box-sizing: border-box;
            text-align: center;
            font-weight: bold;
            text-shadow: 2.4px 2.4px 4.8px rgba(0, 0, 0, 0.8);
            overflow-y: auto;
            resize: vertical;
        }
        
        .rich-text-editor:focus {
            outline: 2px solid rgba(255, 255, 255, 0.5);
            background: rgba(0, 0, 0, 0.7);
        }
        
        .rich-text-editor:empty::before {
            content: attr(data-placeholder);
            color: rgba(232, 232, 232, 0.7);
            pointer-events: none;
        }
        
        .rich-text-editor .font-small {
            font-size: 1.5rem;
        }
        
        .rich-text-editor .font-medium {
            font-size: 2.5rem;
        }
        
        .rich-text-editor .font-large {
            font-size: 4rem;
        }
        
        .text-area-section textarea::placeholder {
            color: rgba(232, 232, 232, 0.7);
        }
        
        .text-area-section textarea:focus {
            outline: 2px solid rgba(255, 255, 255, 0.5);
            background: rgba(0, 0, 0, 0.7);
        }
        
        .input-section {
            margin: 18px 0;
        }
        
        .time-input {
            display: inline-block;
            margin: 0 12px;
        }
        
        .time-input input {
            width: 72px;
            padding: 12px;
            font-size: 1.44rem;
            text-align: center;
            border: none;
            border-radius: 9.6px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(5px);
        }
        
        .time-input input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .time-input label {
            display: block;
            margin-bottom: 6px;
            font-size: 1.08rem;
            opacity: 0.8;
        }
        
        .controls {
            margin: 36px 0;
        }
        
        button {
            padding: 8px 16px;
            margin: 0 5px;
            font-size: 0.9rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
        }
        
        .start-btn {
            background: #4CAF50;
            color: white;
        }
        
        .start-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.7);
        }
        
        .pause-btn {
            background: #ff9800;
            color: white;
        }
        
        .pause-btn:hover {
            background: #e68900;
            transform: translateY(-2px);
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.7);
        }
        
        .reset-btn {
            background: #f44336;
            color: white;
        }
        
        .reset-btn:hover {
            background: #da190b;
            transform: translateY(-2px);
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.7);
        }
        
        .status {
            margin: 24px 0;
            font-size: 1.44rem;
            font-weight: bold;
            font-style: italic;
            text-shadow: 1.2px 1.2px 2.4px rgba(0, 0, 0, 0.6);
            width: 100%;
        }
        
        .finished {
            animation: pulse 1s infinite;
        }

        .overtime {
            color: #ff4444 !important;
            animation: pulse 1s infinite;
            font-size: 6.8rem !important;
        }

        .fullscreen-btn {
            padding: 8px 16px;
            margin: 0 5px;
            font-size: 0.9rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            background: #2196F3;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
        }

        .fullscreen-btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.7);
        }

        .sound-enabled {
            background: #9C27B0 !important;
        }

        .sound-disabled {
            background: #FF8C00 !important;
        }
        
        .warning-controls {
            margin: 12px 0;
        }
        
        .warning-btn {
            padding: 6px 12px;
            margin: 0 4px;
            font-size: 0.8rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            background: #666666;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
        }
        
        .warning-btn:hover {
            transform: translateY(-1px);
            box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.6);
        }
        
        .warning-btn.active {
            background: #FF6600;
        }
        
        .background-selector {
            margin: 12px 0;
        }
        
        .background-selector select {
            padding: 8px 12px;
            font-size: 0.9rem;
            border: none;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(5px);
            cursor: pointer;
            font-weight: bold;
        }
        
        .background-selector select option {
            background: rgba(0, 0, 0, 0.8);
            color: white;
        }
        
        .background-selector label {
            display: block;
            margin-bottom: 6px;
            font-size: 1.08rem;
            opacity: 0.8;
        }
        
        .text-controls {
            display: flex;
            justify-content: flex-end;
            gap: 6px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 4.8px 8px;
            font-size: 0.6rem;
            border: none;
            border-radius: 4.8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            background: #808080;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
            min-width: 24px;
        }
        
        .control-btn:hover {
            background: #404040;
            transform: translateY(-1px);
            box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.6);
        }
        
        .control-btn.active {
            background: #404040;
        }
        
        .color-picker {
            width: 32px;
            height: 25.6px;
            border: none;
            border-radius: 4.8px;
            cursor: pointer;
            background: none;
        }
        
        .resize-handle {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0 0 7.2px 7.2px;
            cursor: ns-resize;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .resize-handle:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .resize-handle::after {
            content: '⋯';
            color: rgba(255, 255, 255, 0.5);
            font-size: 1rem;
            transform: rotate(90deg);
        }
        
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        #flashOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
            animation: none;
        }

        @keyframes flash {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.8; }
        }

        /* Responsive scaling for different resolutions */
        @media screen and (max-width: 1920px) {
            body { zoom: calc(100vw / 1920 * 100%); }
        }
        @media screen and (min-width: 1921px) and (max-width: 2560px) {
            body { zoom: calc(100vw / 2560 * 133%); }
        }
        @media screen and (min-width: 2561px) {
            body { zoom: calc(100vw / 3840 * 200%); }
        }
    </style>
</head>
<body>
    <div class="timer-container">
        <div class="text-area-section">
            <div class="text-controls">
                <button class="control-btn" id="headingSpellCheck" title="Toggle Spell Check">Spell Check</button>
                <button class="control-btn" id="boldBtn" title="Toggle Bold">Bold</button>
                <button class="control-btn" id="italicBtn" title="Toggle Italic">Italic</button>
                <button class="control-btn" id="underlineBtn" title="Toggle Underline">Underline</button>
                <button class="control-btn" id="fontSizeSmall" title="Small Font">A-</button>
                <button class="control-btn" id="fontSizeMedium" title="Medium Font">A</button>
                <button class="control-btn" id="fontSizeLarge" title="Large Font">A+</button>
                <input type="color" id="headingColorPicker" class="color-picker" value="#E8E8E8" title="Text Color">
            </div>
            <div id="headingText" contenteditable="true" spellcheck="true" class="rich-text-editor" data-placeholder="Enter your text here...">Enter your text here...</div>
            <div class="resize-handle" id="resizeHandle"></div>
        </div>
        
        <div class="timer-display" id="timerDisplay">00:00:00</div>
        
        <div class="input-section">
            <div class="time-input">
                <label>Hours</label>
                <input type="number" id="hours" min="0" max="23" value="0" placeholder="0">
            </div>
            <div class="time-input">
                <label>Minutes</label>
                <input type="number" id="minutes" min="0" max="59" value="50" placeholder="50">
            </div>
            <div class="time-input">
                <label>Seconds</label>
                <input type="number" id="seconds" min="0" max="59" value="0" placeholder="0">
            </div>
        </div>
        
    <div class="controls">
    <button class="start-btn" id="startBtn">Start</button>
    <button class="pause-btn" id="pauseBtn">Pause</button>
    <button class="reset-btn" id="resetBtn">Reset</button>
    <button class="fullscreen-btn" id="fullscreenBtn" title="Fullscreen">🔲</button>
    <button class="fullscreen-btn sound-enabled" id="soundBtn" title="Sound Toggle">🔊</button>
</div>
        
        <div class="warning-controls">
            <button class="warning-btn active" id="warning20Btn" title="Toggle 20min Warning">20min Warning: ON</button>
            <button class="warning-btn active" id="warning5Btn" title="Toggle 5min Warning">5min Warning: ON</button>
        </div>
        
        <div class="background-selector">
            <label for="backgroundSelect">Background:</label>
            <select id="backgroundSelect">
                <option value="great-wave-off-kanagawa-katsushika-hokusai-1833-25047ac6.jpg">Great Wave off Kanagawa - Hokusai</option>
                <option value="Fine Wind, Clear Morning (Red Fuji) -  Katsushika Hokusai.jpg">Red Fuji - Hokusai</option>
                <option value="The_Sea_at_Les_Saintes-Maries-de-la-Mer_Vincent_Van_Gogh.jpg">The Sea at Les Saintes-Maries-de-la-Mer - Van Gogh</option>
                <option value="landscape-at-saint-remy-enclosed-field-with-peasant-vincent-van-gogh-1889-e0de449e.jpg">Landscape at Saint-Rémy - Van Gogh</option>
                <option value="Tulip_Fields_near_The_Hague_Claude_Monet.jpg">Tulip Fields near The Hague - Monet</option>
                <option value="the-artist-s-garden-at-eragny-camille-pissarro-1898-27bb56b5.jpg">The Artist's Garden at Eragny - Pissarro</option>
                <option value="peasant-house-at-eragny-camille-pissarro-dc5fcc0b.jpg">Peasant House at Eragny - Pissarro</option>
                <option value="poppies-isles-of-shoals-childe-hassam-1891-8b2a05b3.jpg">Poppies, Isles of Shoals - Hassam</option>
                <option value="dahlias-hannah-borger-overbeck-1915-2ddf37cf.jpg">Dahlias - Hannah Borger Overbeck</option>
                <option value="modern-rome-campo-vaccino-joseph-mallord-william-turner-1839-478f6cef.jpg">Modern Rome - Turner</option>
                <option value="_Shade_and_Darkness_-_the_Evening_of_the_Deluge_-_N00531_-_National_Gallery - Joseph_Mallord_William_Turner_(1775-1851)_- (1).jpg">Shade and Darkness - Turner</option>
                <option value="A_Mountain_Landscape_With_An_Approaching_Storm_by_Claude-Joseph_Vernet.jpg">Mountain Landscape with Approaching Storm - Vernet</option>
                <option value="Seaport_by_Moonlight_-Vernet,_Claude_Joseph_-__1771.jpg">Seaport by Moonlight - Vernet</option>
                <option value="italian-landscape-with-umbrella-pines-hendrik-voogd-1807-8040093e.jpg">Italian Landscape with Umbrella Pines - Voogd</option>
                <option value="mountain-stream-in-the-auvergne-theodore-rousseau-1830-0e625ae7.jpg">Mountain Stream in the Auvergne - Rousseau</option>
                <option value="the-stream-le-ruisseau-du-puits-noir-vallee-de-la-loue-gustave-courbet-1855-8c921256.jpg">The Stream - Courbet</option>
                <option value="ancient-rome-giovanni-paolo-panini-1757-cd144dbe.jpg">Ancient Rome - Panini</option>
                <option value="Solen_av_Edvard_Munch.jpg">The Sun - Edvard Munch</option>
            </select>
        </div>
        
        <div class="status" id="status">Ready</div> <!-- REPLACE THIS AREA - Default status message -->
    </div>
    <div id="flashOverlay"></div>

    <script>
        // Global variables
        let totalSeconds = 0;
        let isTimerActive = false; // This controls whether the timer should count down
        let isPaused = false;
        let audioEnabled = true;
        let currentAudio = null;
        let soundTimeouts = [];
        let hasTriggered5MinWarning = false;
        let hasTriggered20MinWarning = false;
        let warning20Enabled = true;
        let warning5Enabled = true;
        let hasFinished = false;
        let currentBackground = 'great-wave-off-kanagawa-katsushika-hokusai-1833-25047ac6.jpg';

        // Start the continuous ticker immediately
        const continuousInterval = setInterval(ticker, 1000);

        // The main ticker function that runs every second
        function ticker() {
            if (isTimerActive && !isPaused) {
                if (totalSeconds > 0) {
                    totalSeconds--;
                } else {
                    // In overtime - count backwards from 0
                    totalSeconds--;
                }
                updateDisplay();

                // Check for 20-minute warning (1200 seconds)
                if (totalSeconds === 1200 && warning20Enabled && !hasTriggered20MinWarning) {
                    hasTriggered20MinWarning = true;
                    triggerFlash(5); // 5 second flash
                }

                // Check for 5-minute warning (300 seconds)
                if (totalSeconds === 300 && warning5Enabled && !hasTriggered5MinWarning) {
                    hasTriggered5MinWarning = true;
                    triggerFlash(5); // 5 second flash
                }

                // Check if timer finished (reached 0)
                if (totalSeconds === 0 && !hasFinished) {
                    hasFinished = true;
                    document.getElementById('status').textContent = 'Out of time - OVERTIME!'; /* REPLACE THIS AREA - Timer finished status message */
                    document.getElementById('timerDisplay').classList.add('finished');
                    document.getElementById('timerDisplay').classList.add('overtime');

                    triggerFlash(300);
                    playNotificationSound();
                }

                // Update overtime styling
                if (totalSeconds < 0) {
                    document.getElementById('timerDisplay').classList.add('overtime');
                    document.getElementById('status').textContent = 'OVERTIME!';
                }
            }
        }

        function toggleAudio() {
            console.log('toggleAudio called, current state:', audioEnabled);
            const soundBtn = document.getElementById('soundBtn');
            
            if (!audioEnabled) {
                audioEnabled = true;
                soundBtn.textContent = '🔊';
                soundBtn.className = 'fullscreen-btn sound-enabled';
                soundBtn.title = 'Disable Sound';
                console.log('Audio ENABLED');
            } else {
                audioEnabled = false;
                stopCurrentAudio();
                soundBtn.textContent = '🔇';
                soundBtn.className = 'fullscreen-btn sound-disabled';
                soundBtn.title = 'Enable Sound';
                console.log('Audio DISABLED');
            }
        }

        function stopCurrentAudio() {
            console.log('STOPPING ALL AUDIO - current audio exists:', !!currentAudio, 'timeouts count:', soundTimeouts.length);
            
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
                console.log('Audio stopped and cleared');
            }
            
            soundTimeouts.forEach((timeout, index) => {
                clearTimeout(timeout);
                console.log('Cleared timeout', index);
            });
            soundTimeouts = [];
            console.log('All timeouts cleared');
        }

        function playNotificationSound() {
            if (!audioEnabled) {
                console.log('Audio not enabled - no sound will play');
                return;
            }
            
            console.log('Starting sound notification sequence');
            
            try {
                const audio = new Audio('game-level-complete-143022.mp3'); // REPLACE THIS AREA - Sound file for timer completion
                audio.volume = 0.8;
                currentAudio = audio;
                
                let playCount = 0;
                
                function playSound() {
                    if (!audioEnabled || !currentAudio) {
                        console.log('Sound sequence stopped - audio disabled or cleared');
                        return;
                    }
                    
                    if (playCount < 3) {
                        audio.currentTime = 0;
                        console.log('Playing sound', playCount + 1, 'of 3');
                        
                        audio.play().then(() => {
                            console.log(`Sound ${playCount + 1}/3 played successfully`);
                            playCount++;
                            
                            if (playCount < 3 && audioEnabled && currentAudio) {
                                console.log('Scheduling next sound in 3 seconds');
                                const timeout = setTimeout(playSound, 2500);
                                soundTimeouts.push(timeout);
                            } else {
                                console.log('Sound sequence complete');
                                currentAudio = null;
                            }
                        }).catch(e => {
                            console.log('Sound play failed:', e);
                            currentAudio = null;
                        });
                    }
                }
                
                playSound();
                
            } catch (e) {
                console.log('Sound creation failed:', e);
            }
        }

        function formatTime(seconds) {
            const isNegative = seconds < 0;
            const absSeconds = Math.abs(seconds);
            const hours = Math.floor(absSeconds / 3600);
            const minutes = Math.floor((absSeconds % 3600) / 60);
            const secs = absSeconds % 60;
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            return isNegative ? `-${timeString}` : timeString;
        }

        function updateDisplay() {
            const timeString = formatTime(totalSeconds);
            document.getElementById('timerDisplay').textContent = timeString;
            // Update the page title/tab with the countdown // REPLACE THIS AREA - 3x tab areas below *
            if (isTimerActive && !isPaused && totalSeconds > 0) {
                document.title = `${timeString} - Art Backgrounds Timer`;
            } else if (totalSeconds < 0) {
                document.title = `OVERTIME ${timeString} - Art Backgrounds Timer`;
            } else if (totalSeconds === 0 && hasFinished) {
                document.title = "Time's Up! - Art Backgrounds Timer";
            } else {
                document.title = "Art Backgrounds Timer";
            }
        }

        function setTimerFromInputs() {
            const hours = parseInt(document.getElementById('hours').value) || 0;
            const minutes = parseInt(document.getElementById('minutes').value) || 0;
            const seconds = parseInt(document.getElementById('seconds').value) || 0;
            totalSeconds = hours * 3600 + minutes * 60 + seconds;
            updateDisplay();
        }

        function startTimer() {
            if (!isTimerActive && !isPaused) {
                setTimerFromInputs();
            }

            if (totalSeconds <= 0) {
                document.getElementById('status').textContent = 'Please set a time first!'; /* REPLACE THIS AREA - Error message when no time set */
                return;
            }

            isTimerActive = true;
            isPaused = false;
            hasFinished = false;
                    document.getElementById('status').textContent = 'Countdown in progress'; /* REPLACE THIS AREA - Timer running status message */
            document.getElementById('startBtn').textContent = 'Resume';
        }

        function pauseTimer() {
            if (isTimerActive) {
                isPaused = true;
                document.getElementById('status').textContent = 'Paused'; /* REPLACE THIS AREA - Timer paused status message */

                const overlay = document.getElementById('flashOverlay');
                overlay.style.animation = 'none';
                overlay.style.opacity = '0';
            }
        }

        function resetTimer() {
            console.log('RESET BUTTON PRESSED');
            
            isTimerActive = false;
            isPaused = false;
            hasTriggered5MinWarning = false;
            hasTriggered20MinWarning = false;
            hasFinished = false;
            setTimerFromInputs();
            updateDisplay();
            document.getElementById('status').textContent = 'Ready'; /* REPLACE THIS AREA - Timer reset status message */
            document.getElementById('timerDisplay').classList.remove('finished');
            document.getElementById('timerDisplay').classList.remove('overtime');
            document.getElementById('startBtn').textContent = 'Start';
            document.getElementById('flashOverlay').style.animation = 'none';
            document.getElementById('flashOverlay').style.opacity = '0';
            document.title = "Art Backgrounds Timer"; // Reset tab title
            
            stopCurrentAudio();
            console.log('Reset complete');
        }

        function triggerFlash(durationInSeconds) {
            const overlay = document.getElementById('flashOverlay');
            
            // Set different images based on the warning type
            if (durationInSeconds === 5) {
                // 5-minute warning - use 5-minute warning image (80% size)
                overlay.style.backgroundImage = 'url(panic.png)'; /* REPLACE THIS AREA - Image for 5-minute warning */
                overlay.style.backgroundSize = '80%';
            } else {
                // Timer finished - use time's up image
                overlay.style.backgroundImage = 'url(TimesUp.png)'; /* REPLACE THIS AREA - Image for timer finished */
                overlay.style.backgroundSize = 'cover';
            }
            
            overlay.style.animation = 'flash 1s infinite';
            overlay.style.opacity = '1';

            setTimeout(() => {
                overlay.style.animation = 'none';
                overlay.style.opacity = '0';
            }, durationInSeconds * 1000);
        }

        function toggleFullscreen() {
            const elem = document.documentElement;

            if (!document.fullscreenElement) {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }

        function toggle20MinWarning() {
            warning20Enabled = !warning20Enabled;
            const btn = document.getElementById('warning20Btn');
            btn.classList.toggle('active', warning20Enabled);
            btn.style.background = warning20Enabled ? '#FF6600' : '#666666';
            btn.textContent = warning20Enabled ? '20min Warning: ON' : '20min Warning: OFF';
        }

        function toggle5MinWarning() {
            warning5Enabled = !warning5Enabled;
            const btn = document.getElementById('warning5Btn');
            btn.classList.toggle('active', warning5Enabled);
            btn.style.background = warning5Enabled ? '#FF6600' : '#666666';
            btn.textContent = warning5Enabled ? '5min Warning: ON' : '5min Warning: OFF';
        }

        function changeBackground() {
            const select = document.getElementById('backgroundSelect');
            const selectedBg = select.value;
            currentBackground = selectedBg;
            
            const backgroundUrl = `Backgrounds/${selectedBg}`;
            document.body.style.backgroundImage = `url(${backgroundUrl})`;
            
            console.log('Background changed to:', selectedBg);
        }

        function setupTextControls() {
            // Setup elements
            const headingSpellCheckBtn = document.getElementById('headingSpellCheck');
            const boldBtn = document.getElementById('boldBtn');
            const italicBtn = document.getElementById('italicBtn');
            const underlineBtn = document.getElementById('underlineBtn');
            const fontSizeSmall = document.getElementById('fontSizeSmall');
            const fontSizeMedium = document.getElementById('fontSizeMedium');
            const fontSizeLarge = document.getElementById('fontSizeLarge');
            const headingEditor = document.getElementById('headingText');
            const headingColorPicker = document.getElementById('headingColorPicker');
            const resizeHandle = document.getElementById('resizeHandle');
            
            // Spell check toggle functionality - Fixed
            headingSpellCheckBtn.addEventListener('click', function() {
                const currentSpellCheck = headingEditor.getAttribute('spellcheck') === 'true';
                headingEditor.setAttribute('spellcheck', !currentSpellCheck);
                headingSpellCheckBtn.classList.toggle('active', !currentSpellCheck);
                headingSpellCheckBtn.textContent = !currentSpellCheck ? 'Spell Check' : 'spell check';
                headingSpellCheckBtn.title = !currentSpellCheck ? 'Disable Spell Check' : 'Enable Spell Check';
                
                // Force re-render of spell check
                const content = headingEditor.innerHTML;
                headingEditor.innerHTML = '';
                headingEditor.innerHTML = content;
            });
            
            // Text formatting functionality
            boldBtn.addEventListener('click', function() {
                document.execCommand('bold', false, null);
                updateFormatButtons();
            });
            
            italicBtn.addEventListener('click', function() {
                document.execCommand('italic', false, null);
                updateFormatButtons();
            });
            
            underlineBtn.addEventListener('click', function() {
                document.execCommand('underline', false, null);
                updateFormatButtons();
            });
            
            // Font size functionality
            fontSizeSmall.addEventListener('click', function() {
                applyFontSize('font-small');
                updateFontSizeButtons('small');
            });
            
            fontSizeMedium.addEventListener('click', function() {
                applyFontSize('font-medium');
                updateFontSizeButtons('medium');
            });
            
            fontSizeLarge.addEventListener('click', function() {
                applyFontSize('font-large');
                updateFontSizeButtons('large');
            });
            
            // Color picker functionality
            headingColorPicker.addEventListener('input', function() {
                document.execCommand('foreColor', false, this.value);
            });
            
            // Update button states when selection changes
            headingEditor.addEventListener('mouseup', updateFormatButtons);
            headingEditor.addEventListener('keyup', updateFormatButtons);
            
            // Setup resize functionality
            setupResizeHandle(resizeHandle, headingEditor);
            
            // Initialize button states
            headingSpellCheckBtn.classList.add('active');
            fontSizeMedium.classList.add('active');
        }
        
        function applyFontSize(className) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                if (!range.collapsed) {
                    // Text is selected - wrap it in a span with the font size class
                    const span = document.createElement('span');
                    span.className = className;
                    try {
                        range.surroundContents(span);
                    } catch (e) {
                        // If surroundContents fails, extract and wrap the contents
                        const contents = range.extractContents();
                        span.appendChild(contents);
                        range.insertNode(span);
                    }
                    selection.removeAllRanges();
                } else {
                    // No text selected - set default font size for new text
                    document.getElementById('headingText').style.fontSize = 
                        className === 'font-small' ? '1.5rem' : 
                        className === 'font-large' ? '4rem' : '2.5rem';
                }
            }
        }
        
        function updateFormatButtons() {
            const boldBtn = document.getElementById('boldBtn');
            const italicBtn = document.getElementById('italicBtn');
            const underlineBtn = document.getElementById('underlineBtn');
            
            // Update button states
            const isBold = document.queryCommandState('bold');
            const isItalic = document.queryCommandState('italic');
            const isUnderline = document.queryCommandState('underline');
            
            boldBtn.classList.toggle('active', isBold);
            italicBtn.classList.toggle('active', isItalic);
            underlineBtn.classList.toggle('active', isUnderline);
        }
        
        function updateFontSizeButtons(activeSize) {
            const fontSizeSmall = document.getElementById('fontSizeSmall');
            const fontSizeMedium = document.getElementById('fontSizeMedium');
            const fontSizeLarge = document.getElementById('fontSizeLarge');
            
            // Remove active class from all font size buttons
            [fontSizeSmall, fontSizeMedium, fontSizeLarge].forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to selected button
            if (activeSize === 'small') fontSizeSmall.classList.add('active');
            else if (activeSize === 'large') fontSizeLarge.classList.add('active');
            else fontSizeMedium.classList.add('active');
        }
        
        function setupResizeHandle(handle, editor) {
            let isResizing = false;
            let startY = 0;
            let startHeight = 0;
            
            handle.addEventListener('mousedown', function(e) {
                isResizing = true;
                startY = e.clientY;
                startHeight = parseInt(getComputedStyle(editor).height, 10);
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;
                
                const deltaY = e.clientY - startY;
                const newHeight = startHeight + deltaY;
                
                // Set min and max height
                if (newHeight >= 200 && newHeight <= 1000) {
                    editor.style.height = newHeight + 'px';
                }
            });
            
            document.addEventListener('mouseup', function() {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.userSelect = '';
                }
            });
        }


        // Set up all event listeners when page loads
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Page loaded, setting up event listeners');
            
            updateDisplay();

            // Add all button event listeners
            document.getElementById('startBtn').addEventListener('click', startTimer);
            document.getElementById('pauseBtn').addEventListener('click', pauseTimer);
            document.getElementById('resetBtn').addEventListener('click', resetTimer);
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
            document.getElementById('soundBtn').addEventListener('click', toggleAudio);
            document.getElementById('warning20Btn').addEventListener('click', toggle20MinWarning);
            document.getElementById('warning5Btn').addEventListener('click', toggle5MinWarning);
            document.getElementById('backgroundSelect').addEventListener('change', changeBackground);

            // Time input listeners
            ['hours', 'minutes', 'seconds'].forEach(id => {
                document.getElementById(id).addEventListener('input', function () {
                    if (!isTimerActive && !isPaused) {
                        setTimerFromInputs();
                    }
                });
            });

            // Rich text editor setup
            const richTextEditor = document.getElementById('headingText');

            // Text control functionality
            setupTextControls();

            // Keyboard shortcuts
            document.addEventListener('keydown', function (e) {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.contentEditable === 'true') {
                    return;
                }

                if (e.code === 'Escape') {
                    resetTimer();
                }
            });

            console.log('All event listeners set up successfully');
        });
    </script>
    
    <script>
        // Progressive loading for high-resolution backgrounds
        function loadHighResBackground() {
            if (window.innerWidth > 1920 || window.devicePixelRatio > 1.5) {
                // Art backgrounds are already high quality, no need for additional loading
                console.log('High-res background loading not needed for art backgrounds');
            }
        }

        // Load high-res after page loads
        window.addEventListener('load', loadHighResBackground);
    </script>
</body>
</html>